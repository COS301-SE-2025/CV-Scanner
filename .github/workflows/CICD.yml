name: Deploy CV Scanner Apps

on:
  push:
    branches:
      - main   # ðŸ‘ˆ change if your default branch is different

jobs:
  build-and-deploy-ui:
    name: Deploy Frontend (UI)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install and build UI
        working-directory: UI/CV-Scanner
        run: |
          npm install
          npm run build

      - name: Deploy to Azure App Service (UI)
        uses: azure/webapps-deploy@v2
        with:
          app-name: cvscanner-ui   # ðŸ‘ˆ your frontend app name
          publish-profile: ${{ secrets.AZURE_CREDENTIALS }}

  build-and-deploy-api:
    name: Deploy Backend API
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install and build API
        working-directory: api
        run: |
          npm install
          npm run build

      - name: Deploy to Azure App Service (API)
        uses: azure/webapps-deploy@v2
        with:
          app-name: cvscanner-api   # ðŸ‘ˆ backend app service name
          publish-profile: ${{ secrets.AZURE_CREDENTIALS }}

  build-and-deploy-ai:
    name: Deploy AI Service
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies (AI)
        working-directory: ai
        run: |
          pip install -r requirements.txt

      - name: Deploy to Azure App Service (AI)
        uses: azure/webapps-deploy@v2
        with:
          app-name: cvscanner-ai   # ðŸ‘ˆ AI app service name
          publish-profile: ${{ secrets.AZURE_CREDENTIALS }}
